#!/bin/bash

# contiene:
# - le funzioni comuni
# - la richiesta dei parametri utente
# - la creazione delle cartelle di progetto
source "common.sh"

# Creazione di una sessione Tmux con attivazione VPN
tmux new-session -d -s PT -n "varie ed eventuali"

# OPEN-VPN
#tmux new-window -t PT:1 -n 'openVPN'
#tmux send-keys -t PT:1 "sudo openvpn /home/kali/Desktop/htb/lab_dok72.ovpn" Enter


# INFORMATION GATHERING
cd $folderProjectInfoGathering
# Layout
tmux new-window -t PT:1 -n 'Information Gathering (dmitry, theharvester ...)'
tmux split-window -v -t PT:1.0
tmux split-window -v -t PT:1.1
tmux split-window -v -t PT:1.2
tmux split-window -v -t PT:1.3
# Esecuzione dei comandi nelle sottofinestre
# NMAP TCP - UDP
tmux send-keys -t PT:1.0 "dmitry -news $domain -o $folderProjectInfoGathering/dmitry.txt"
tmux send-keys -t PT:1.1 "theHarvester -d $domain -b all -l 500 -f $folderProjectInfoGathering/theharvester.html"
tmux send-keys -t PT:1.2 "ping -c 4 $ip # ping to find OS"
tmux send-keys -t PT:1.3 "nmap -Pn -O $ip # find OS"
cd $folderProject

# SERVICE INFORMATION GATHERING
cd $folderProjectServiceInfoGathering
# Layout
tmux new-window -t PT:2 -n 'Service Information Gathering (nmap)'
tmux split-window -v -t PT:2.0
tmux split-window -v -t PT:2.1
tmux split-window -v -t PT:2.2
tmux select-pane -t "2.2"
tmux split-window -h -t "2.2"
tmux split-window -h -t "2.2"
# Esecuzione dei comandi nelle sottofinestre
# NMAP TCP - UDP
tmux send-keys -t PT:2.0 "sudo nmap -sV -vv -p- -T5 --script firewall-bypass $ip -oA out.TCP" Enter
tmux send-keys -t PT:2.1 "sudo nmap -sU -Pn -p 53,69,123,161,1985,777,3306 -T5 $ip -oA out.UDP" Enter
tmux send-keys -t PT:2.2 "sudo nmap -Pn --script vuln --script firewall-bypass $ip -oA out.SPEC -p <ports>"
tmux send-keys -t PT:2.3 "sudo nmap --script nmap-vulners/ -sV $ip -oA out.SPEC.vulners -p <ports>"
tmux send-keys -t PT:2.4 "sudo nmap --script vulscan/ -sV $ip -oA out.SPEC.vulscan -p <ports>"
cd $folderProject

# QUICK WIN
cd $folderProjectQuickWin
# Layout
tmux new-window -t PT:3 -n 'QuickWin'
tmux split-window -v -t PT:3.0
tmux split-window -v -t PT:3.1
tmux split-window -v -t PT:3.2
# Esecuzione dei comandi nelle sottofinestre
# FIREFOX
tmux send-keys -t PT:3.0 "xdg-open \"https://duckduckgo.com/?q=<servizio>+default+password\" & xdg-open \"https://duckduckgo.com/?q=<servizio>+default+credentials\" & xdg-open \"https://duckduckgo.com/?q=<servizio>+vulnerability+poc+github\" & xdg-open \"https://duckduckgo.com/?q=<servizio>+exploit+poc+github\""
tmux send-keys -t PT:3.0 "searchsploit \"<servizio>\""
tmux send-keys -t PT:3.1 "msfupdate; msfconsole -qx \"search type:exploit <servizio>\""
tmux send-keys -t PT:3.2 "sudo systemctl stop nessusd & sudo systemctl start nessusd & xdg-open \"https://127.0.0.1:8834/\""

cd $folderProject






# Attivazione della modalit√† interattiva
tmux -2 attach-session -t PT


